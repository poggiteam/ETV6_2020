---
title: "Figures"
author: "Timothée Bigot"
date: "14/04/22"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    code_folding: hide
  pdf_document: 
    toc: true
    toc_depth: 3
    highlight: zenburn
editor_options: 
  chunk_output_type: console
---
---
title:  "Figures à jour le 10/08/22"
---

This Rmarkdown contains the code to obtain all plots necessary to produce our bioinformatical related figures. Final figure anotation and layout were produced with PhotoShop. After figures reorganization, some figures in this scripts are published as "supplementary figures".

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# load objects and libraries
```{r, include=FALSE}
OUTPUT_PATH <- "$WORKING_DIR/03_2020-42-set1et2/"

ctrl.object <- readRDS(file = "$WORKING_DIR/03_2020-42-set1et2/ctrl_object.rds")
pat.object <- readRDS(file = "$WORKING_DIR/03_2020-42-set1et2/pat_object.rds")
ETV6_2020 <- readRDS(file = "$WORKING_DIR/03_2020-42-set1et2/ETV6_2020_regressed_final.rds")

all.genes <- rownames(ETV6_2020)

library(Seurat)
library(ggplot2)
library(dplyr)
library(ggrepel)
library(plotly)
```

# Figure 1 {.tabset}
## Panel B
```{r,fig.width=10,fig.height=10}
# Plotting ctrl.object UMAP with "orig.ident"
ctrl.object@meta.data$orig.ident <- factor(ctrl.object@meta.data$orig.ident,
                                           levels = c("D6", "D11")
                                           )
DimPlot(object = ctrl.object,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "orig.ident",
        order = T
        )
```

## Panel C
```{r,fig.width=10,fig.height=10}
# Plotting ctrl.object UMAP with "RNA_snn_res.1.2"
ggplotly(DimPlot(object = ctrl.object,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "RNA_snn_res.1.2",
        order = T,
        label = T,
        label.size = 6
        ))
```

## Panel D
```{r,fig.width=16,fig.height=8}
# DotPlot of supervised signatures for clusters identification
Idents(ctrl.object) <- "RNA_snn_res.1.2"
ctrl.object@active.ident <- factor(ctrl.object@active.ident,
                                   levels = c("14","12","8","6","3","1","2","0","4","5","9","11","7","10","13")
                                   )
dp <- DotPlot(ctrl.object,
              features = c("THY1","PROM1","FLT3","CRHBP","HOPX","AVP","KIT","SPINK2","CSF3R","MPO","ELANE","PRTN3","AZU1","SERPINB10","CTSG","CPA3","CLC","PRG2","TPSAB1","CD38","TFRC","DEPTOR","KLF1","TFR2","HBB","APOC1","ANK1","ACSM3","VWA5A","LMNA","CAVIN2","LAT","CD9","STOM","PLEK","ITGA2B","GP9","GP6","GP1BA","PF4","RASGRP2","MPIG6B","VWF","PPBP","SELP","LTBP1")
              ) + 
  geom_point(aes(size=pct.exp),
             shape = 21,
             colour="black",
             stroke=0.5
             ) + 
  scale_colour_gradient2(low = "steelblue",
                         mid = "ivory1",
                         high = "red"
                         ) + 
  guides(size=guide_legend(override.aes=list(shape=21, colour="black", fill="white"))
         ) + 
  RotatedAxis()
dp
```

## Panel E
```{r,fig.width=16,fig.height=8}
# Unsupervised DotPlot with top 5 genes
# FindAllMarkers
if(file.exists(paste(OUTPUT_PATH, "ctrl_FAM.csv", sep = ""))){
  ctrl.markers <- read.csv(file = paste(OUTPUT_PATH, "ctrl_FAM.csv", sep = ""))
  }else{
  Idents(ctrl.object) <- "RNA_snn_res.1.2"
  ctrl.markers <- FindAllMarkers(ctrl.object,
                                        only.pos = F,
                                        min.pct = 0.1,
                                        logfc.threshold = 0.25,
                                        verbose = T
                                        )
  write.csv(ctrl.markers,
                   file = paste(OUTPUT_PATH,
                                "ctrl_FAM.csv",
                                sep = ""
                   )
            )
  }

# Selecting Top 5 genes per cluster and making a list of it
top_genes <- ctrl.markers %>%
  group_by(cluster) %>%
  top_n(5, avg_log2FC)
length(top_genes$gene)

# Ensuring no doublets
str_top_genes <- unique(as.character(top_genes$gene))
length(str_top_genes)

# DotPlot
dp <- DotPlot(ctrl.object,
              features = str_top_genes
              ) +
  geom_point(aes(size=pct.exp),
             shape = 21,
             colour="black",
             stroke=0.5
             ) + 
  scale_colour_gradient2(low = "steelblue",
                         mid = "ivory1",
                         high = "red"
                         ) + 
  guides(size=guide_legend(override.aes=list(shape=21, colour="black", fill="white"))
         ) +
  RotatedAxis()
dp
```

## Panel F
```{r,fig.width=10,fig.height=10}
# ggplot UMAP with genes expressed counts
UMAP <- data.frame(UMAP_1 = ctrl.object@reductions$umap@cell.embeddings[,1],
                   UMAP_2 = ctrl.object@reductions$umap@cell.embeddings[,2],
                   gene = ctrl.object@meta.data$nFeature_RNA)

Mutation = ctrl.object@meta.data$ETV6status
Max=max(ctrl.object@meta.data$nFeature_RNA)
Min=min(ctrl.object@meta.data$nFeature_RNA)

ggplot(UMAP,aes(x=UMAP_1,y=UMAP_2)
       )+
  geom_point(aes(color=gene, shape = Mutation)
             ) + 
  scale_colour_gradient2(low = "blue",
                         mid="orange",
                         high="red",
                         name="n° of genes expressed",
                         midpoint=(Max+Min)/2
                         )
```

## Panel G
```{r,fig.width=10,fig.height=10}
# ggplot UMAP with mRNA counts
UMAP <- data.frame(UMAP_1 = ctrl.object@reductions$umap@cell.embeddings[,1],
                   UMAP_2 = ctrl.object@reductions$umap@cell.embeddings[,2],
                   gene = ctrl.object@meta.data$nCount_RNA)

Mutation = ctrl.object@meta.data$ETV6status
Max=max(ctrl.object@meta.data$nCount_RNA)
Min=min(ctrl.object@meta.data$nCount_RNA)

ggplot(UMAP,aes(x=UMAP_1,y=UMAP_2)
       )+
  geom_point(aes(
    color=gene,
    shape = Mutation)
    )+
  scale_colour_gradient2(low = "blue",
                         mid="orange",
                         high="red",
                         name="mRNA count",
                         midpoint=(Max+Min)/2
                         )
```

## Panel H
```{r,fig.width=10,fig.height=10}
# Cell assignation based on signatures & both DotPlots
Idents(ctrl.object) <- "RNA_snn_res.1.2"
ctrl.object@meta.data$celltypes <- "NA"

for (i in 1:length(rownames(ctrl.object@meta.data))){
    if (ctrl.object@meta.data$RNA_snn_res.1.2[i] %in% c(1,6,3,8,12)){
      ctrl.object@meta.data$celltypes[i] <- "MkP_Mk"
      }
    if (ctrl.object@meta.data$RNA_snn_res.1.2[i] %in% 14){
      ctrl.object@meta.data$celltypes[i] <- "Plt"
      }
    if (ctrl.object@meta.data$RNA_snn_res.1.2[i] %in% c(2,0,4,5,9)){
      ctrl.object@meta.data$celltypes[i] <- "MEP"
      }
    if (ctrl.object@meta.data$RNA_snn_res.1.2[i] %in% 7){
      ctrl.object@meta.data$celltypes[i] <- "CMP"
      }
    if (ctrl.object@meta.data$RNA_snn_res.1.2[i] %in% 11){
      ctrl.object@meta.data$celltypes[i] <- "CMP_Primed"
      }
    if (ctrl.object@meta.data$RNA_snn_res.1.2[i] %in% 13){
      ctrl.object@meta.data$celltypes[i] <- "GMP"
      }
    if (ctrl.object@meta.data$RNA_snn_res.1.2[i] %in% 10){
      ctrl.object@meta.data$celltypes[i] <- "HSPC"
      }
}

# Plotting by celltypes
DimPlot(object = ctrl.object,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "celltypes",
        order = T
        )
```

## Panel I {.tabset}
```{r,fig.width=10,fig.height=10}
# FeaturePlot on signatures estimated from literature and implemented with genes from top 20 genes of each clusters
# Defining signatures & adding them to the object by incorporating it in the meta.data
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("PROM1","FLT3","CRHBP","HOPX","AVP","IGHM","GLIPR1")),
                              name = "HSPC"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("CPA3","PRG2","RHEX","ALOX5AP","MS4A2")),
                              name = "CMP"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("MS4A3","RNASE2","EPX","CLC","CSF2RB","CTSG")),
                              name = "non_primed_CMP"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("LMNA","CAVIN2","LAT","VWA5A","KIT","HPGDS","KRT1","TPSB2","TPSAB1","TMEM176B","SAMSN1","CD44")),
                              name = "Mk_primed_CMP"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("CSTA","MPO","ELANE","PRTN3","AZU1","RNASE3","CFD")),
                              name = "GMP"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("CD38","KLF1","DEPTOR","ACSM3","APOC1","TFRC","ANK1","TMSB10","ALDH1A1","MT-ATP8","H2AFY","GYPB")),
                              name = "MEP"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("BLVRB","HBB","APOC1","TFR2")),
                              name = "MEP_ERP"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("MPIG6B","PF4","GP9","VWF","PPBP","SH3BP5","SELP","LTBP1","TMEM40")),
                              name = "MkP_Mk"
                              )

# FeaturePlots {.tabset}
sig_list <- c("HSPC1","CMP1","non_primed_CMP1","Mk_primed_CMP1","GMP1","MEP1","MEP_ERP1","MkP_Mk1")

for (i in 1:length(sig_list)){
    tryCatch({
      print(paste("###", sig_list[i], sep = " "))
      print(FeaturePlot(object = ctrl.object,
                        features = sig_list[i],
                        reduction = "umap",
                        cols = c("grey","lightblue","cyan3","cyan4","dodgerblue3","blue","mediumslateblue","purple","orchid3","red","brown","black"),
                        pt.size = 0.7)+
              NoAxes()+
              NoLegend()
            )
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
}
```

# Figure 2 {.tabset}
## Panel A
```{r,fig.width=10,fig.height=10}
ctrl.object@meta.data$celltypes <- factor(ctrl.object@meta.data$celltypes, levels = c("HSPC","GMP","CMP","CMP_Primed","MEP","MkP_Mk","Plt"))

# FindAllMarkers
if(file.exists(paste0(OUTPUT_PATH, "ctrl.object_FAM_regulons.csv"))){
  ctrl.regulons <- read.csv(file = paste0(OUTPUT_PATH, "ctrl.object_FAM_regulons.csv"))
  }else{
  Idents(ctrl.object) <- "celltypes"
  ctrl.regulons <- FindAllMarkers(ctrl.object,
                                  only.pos = F,
                                  min.pct = 0.1,
                                  logfc.threshold = 0,
                                  verbose = T,
                                  assay = "AUC",
                                  test.use = "wilcox"
                                  )
  write.csv(ctrl.regulons,
                   file = paste0(OUTPUT_PATH,
                                "ctrl.object_FAM_regulons.csv"
                                )
            )
  }

all.regulons <- rownames(ctrl.object@assays$AUC)
ctrl.object <- ScaleData(ctrl.object, assay = "AUC", features = all.regulons, do.scale = T, do.center = T)
ctrl.top5 <- ctrl.regulons %>% group_by(cluster) %>% top_n(5, avg_log2FC)

## Heatmap top 20 regulons FAM in controls 
DoHeatmap(ctrl.object, features = ctrl.top5$gene, group.by = "celltypes", assay = "AUC", slot = "scale.data", label = T, raster = T) + scale_fill_gradientn(colors = c("blue","white","red"))
```

## Panel B
```{r,fig.width=10,fig.height=10}
# FeaturePlot on regulonic signatures from Figure 2A and implemented with regulons from top 5 genes of each cell type
# Defining signatures & adding them to the object by incorporating it in the meta.data
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("TCF4(+)","HLF(+)","HOXA3(+)","TCF7L2(+)","HOXA9(+)")),
                              name = "auc_HSPC", 
                              assay = "AUC"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("IKZF2(+)","CEBPB(+)","FOXJ1(+)","GATA2(+)","KLF6(+)")),
                              name = "auc_CMP",
                              assay = "AUC"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("GATA2"(+),"KLF6(+)","ZMAT4(+)","BATF(+)")),
                              name = "auc_Mk_primed_CMP",
                              assay = "AUC"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("ZNF502(+)","ETV6(+)","CEBPD(+)","CEBPE(+)","CEBPA(+)")),
                              name = "auc_GMP",
                              assay = "AUC"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("KLF1(+)","SPI1(+)","MECOM(+)","ENO1(+)","ATF5(+)")),
                              name = "auc_MEP",
                              assay = "AUC"
                              )
ctrl.object <- AddModuleScore(ctrl.object,
                              features = list(c("GATA1(+)","MAFG(+)","NFE2(+)","FLI1(+)","ELF1(+)")),
                              name = "auc_MkP_Mk",
                              assay = "AUC"
                              )

# FeaturePlots {.tabset}
sig_list <- c("auc_HSPC1","auc_CMP1","auc_non_primed_CMP1","auc_Mk_primed_CMP1","auc_GMP1","auc_MEP1","auc_MEP_ERP1","auc_MkP_Mk1")

for (i in 1:length(sig_list)){
    tryCatch({
      print(paste("###", sig_list[i], sep = " "))
      print(FeaturePlot(object = ctrl.object,
                        features = sig_list[i],
                        reduction = "umap",
                        cols = c("grey","lightblue","cyan3","cyan4","dodgerblue3","blue","mediumslateblue","purple","orchid3","red","brown","black"),
                        pt.size = 0.7)+
              NoAxes()+
              NoLegend()
            )
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
}
```

## Panel B
```{r,fig.width=10,fig.height=10}
# Plotting pat.object UMAP with "RNA_snn_res.0.8"
ggplotly(DimPlot(object = pat.object,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "RNA_snn_res.0.8",
        order = T,
        label = T,
        label.size = 6
        ))
```

# Figure 3 {.tabset}
## Panel C
```{r,fig.width=10,fig.height=10}
# Plotting pat.object UMAP with "orig.ident"
pat.object@meta.data$orig.ident <- factor(pat.object@meta.data$orig.ident,
                                           levels = c("D6", "D11")
                                           )
DimPlot(object = pat.object,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "orig.ident",
        order = T
        )
        
# Plotting pat.object UMAP with "RNA_snn_res.0.8"
ggplotly(DimPlot(object = pat.object,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "RNA_snn_res.0.8",
        order = T,
        label = T,
        label.size = 6
        ))
```

## Panel D
```{r,fig.width=16,fig.height=8}
# DotPlot of same supervised signatures for clusters identification
Idents(pat.object) <- "RNA_snn_res.0.8"
pat.object@active.ident <- factor(pat.object@active.ident,
                                  levels = c("1","0","8","6","2","5","10","4","7","3","9")
                                  )                                   
dp <- DotPlot(pat.object,
              features = c("THY1","PROM1","FLT3","CRHBP","HOPX","AVP","KIT","SPINK2","CSF3R","MPO","ELANE","PRTN3","AZU1","SERPINB10","CTSG","CPA3","CLC","PRG2","TPSAB1","CD38","TFRC","DEPTOR","KLF1","TFR2","HBB","APOC1","ANK1","ACSM3","VWA5A","LMNA","CAVIN2","LAT","CD9","STOM","PLEK","ITGA2B","GP9","GP6","GP1BA","PF4","RASGRP2","MPIG6B","VWF","PPBP","SELP","LTBP1")
              ) + 
  geom_point(aes(size=pct.exp),
             shape = 21,
             colour="black",
             stroke=0.5
             ) + 
  scale_colour_gradient2(low = "steelblue",
                         mid = "ivory1",
                         high = "red"
                         ) + 
  guides(size=guide_legend(override.aes=list(shape=21, colour="black", fill="white"))
         ) + 
  RotatedAxis()
dp
```

## Panel E
```{r,fig.width=16,fig.height=8}
# Unsupervised DotPlot with top 5 genes
# FindAllMarkers
if(file.exists(paste(OUTPUT_PATH, "pat_FAM.csv", sep = ""))){
  pat.markers <- read.csv(file = paste(OUTPUT_PATH, "pat_FAM.csv", sep = ""))
  }else{
  Idents(pat.object) <- "RNA_snn_res.1.2"
  pat.markers <- FindAllMarkers(pat.object,
                                        only.pos = F,
                                        min.pct = 0.1,
                                        logfc.threshold = 0.25,
                                        verbose = F
                                        )
  write.csv(pat.markers,
                   file = paste(OUTPUT_PATH,
                                "pat_FAM.csv",
                                sep = ""
                   )
            )
  }

# Selecting Top 5 genes per cluster and making a list of it
top_genes <- pat.markers %>%
  group_by(cluster) %>%
  top_n(5, avg_log2FC)
length(top_genes)

# Ensuring no doublets
str_top_genes <- unique(as.character(top_genes$gene))
length(str_top_genes)

# DotPlot
dp <- DotPlot(pat.object,
              features = str_top_genes
              ) +
  geom_point(aes(size=pct.exp),
             shape = 21,
             colour="black",
             stroke=0.5
             ) + 
  scale_colour_gradient2(low = "steelblue",
                         mid = "ivory1",
                         high = "red"
                         ) + 
  guides(size=guide_legend(override.aes=list(shape=21, colour="black", fill="white"))
         ) +
  RotatedAxis()
dp
```

## Panel F {.tabset}
```{r,fig.width=10,fig.height=10}
# FeaturePlot on signatures estimated from literature and implemented with genes from top 20 genes of each clusters
# Defining signatures & adding them to the object by incorporating it in the meta.data
pat.object <- AddModuleScore(pat.object,
                              features = list(c("PROM1","FLT3","CRHBP","HOPX","AVP","IGHM","GLIPR1")),
                              name = "HSPC"
                              )
pat.object <- AddModuleScore(pat.object,
                              features = list(c("CPA3","PRG2","RHEX","ALOX5AP","MS4A2")),
                              name = "CMP"
                              )
pat.object <- AddModuleScore(pat.object,
                              features = list(c("MS4A3","RNASE2","EPX","CLC","CSF2RB","CTSG")),
                              name = "non_primed_CMP"
                              )
pat.object <- AddModuleScore(pat.object,
                              features = list(c("LMNA","CAVIN2","LAT","VWA5A","KIT","HPGDS","KRT1","TPSB2","TPSAB1","TMEM176B","SAMSN1","CD44")),
                              name = "Mk_primed_CMP"
                              )
pat.object <- AddModuleScore(pat.object,
                              features = list(c("CSTA","MPO","ELANE","PRTN3","AZU1","RNASE3","CFD")),
                              name = "GMP"
                              )
pat.object <- AddModuleScore(pat.object,
                              features = list(c("CD38","KLF1","DEPTOR","ACSM3","APOC1","TFRC","ANK1","TMSB10","ALDH1A1","MT-ATP8","H2AFY","GYPB")),
                              name = "MEP"
                              )
pat.object <- AddModuleScore(pat.object,
                              features = list(c("BLVRB","HBB","APOC1","TFR2")),
                              name = "MEP_ERP"
                              )
pat.object <- AddModuleScore(pat.object,
                              features = list(c("MPIG6B","PF4","GP9","VWF","PPBP","SH3BP5","SELP","LTBP1","TMEM40")),
                              name = "MkP_Mk"
                              )

# FeaturePlots {.tabset}
sig_list <- c("HSPC1","CMP1","non_primed_CMP1","Mk_primed_CMP1","GMP1","MEP1","MEP_ERP1","MkP_Mk1")

for (i in 1:length(sig_list)){
    tryCatch({
      print(paste("###", sig_list[i], sep = " "))
      print(FeaturePlot(object = pat.object,
                        features = sig_list[i],
                        reduction = "umap",
                        cols = c("grey","lightblue","cyan3","cyan4","dodgerblue3","blue","mediumslateblue","purple","orchid3","red","brown","black"),
                        pt.size = 0.7)+
              NoAxes()+
              NoLegend()
            )
    }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
}
```

## Panel G
```{r,fig.width=10,fig.height=10}
# Cell assignation based on signatures & both DotPlots
Idents(pat.object) <- "RNA_snn_res.0.8"
pat.object@meta.data$celltypes <- "NA"

for (i in 1:length(rownames(pat.object@meta.data))){
    if (pat.object@meta.data$RNA_snn_res.0.8[i] %in% 1){
      pat.object@meta.data$celltypes[i] <- "MkP_Mk"
      }
    if (pat.object@meta.data$RNA_snn_res.0.8[i] %in% c(0,8,6,2,5)){
      pat.object@meta.data$celltypes[i] <- "MEP"
      }
    if (pat.object@meta.data$RNA_snn_res.0.8[i] %in% 4){
      pat.object@meta.data$celltypes[i] <- "CMP"
      }
    if (pat.object@meta.data$RNA_snn_res.0.8[i] %in% 10){
      pat.object@meta.data$celltypes[i] <- "CMP_Primed"
      }
    if (pat.object@meta.data$RNA_snn_res.0.8[i] %in% 9){
      pat.object@meta.data$celltypes[i] <- "GMP"
      }
    if (pat.object@meta.data$RNA_snn_res.0.8[i] %in% c(3,7)){
      pat.object@meta.data$celltypes[i] <- "HSPC"
      }
}

# Plotting by celltypes

myColors <- c("#F26D6D","#CD9600","#7CAE00","#04BF68","#05AFF2","#CC88FF")
              
DimPlot(object = pat.object,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "celltypes",
        order = T,
        cols = myColors
        )
```

# Figure 4 {.tabset}
## Panel A
* See "trajectory.Rmd"

## Panel B
```{r,fig.height=10,fig.width=10}
myColors <- c("#53B400","#F8766D","#C49A00","#00C094","#00B6EB","#00B6EB","#00B6EB","#00B6EB","#00B6EB","#A58AFF","#A58AFF","#A58AFF","#A58AFF","#A58AFF","#FB61D7")
myColors2 <- c("#53B400","#F8766D","#C49A00","#00C094","#00C094","#00B6EB","#00B6EB","#00B6EB","#00B6EB","#00B6EB","#A58AFF")

gene <- c("CD34","CD38","HLA-DRA","GP9","PF4","ITGA2B","FLI1","GATA1","GATA2")

for (i in gene) {
  Idents(ctrl.object) <- "RNA_snn_res.1.2"
  ctrl.object@meta.data$RNA_snn_res.1.2 <- factor(ctrl.object@meta.data$RNA_snn_res.1.2,
                                                  levels = c("13","7","11","10","9","5","4","0","2","1","3","6","8","12","14")
                                                  )
  p1 <- VlnPlot(ctrl.object,
                features = i,
                pt.size = 0,
                group.by = "RNA_snn_res.1.2",
                log = F,
                cols = myColors,
                assay = "RNA"
                ) + NoLegend() + geom_boxplot()
########################################
  Idents(pat.object) <- "RNA_snn_res.0.8"
  pat.object@meta.data$RNA_snn_res.0.8 <- factor(pat.object@meta.data$RNA_snn_res.0.8,
                                                 levels = c("9","4","10","3","7","5","2","6","8","0","1")
                                                 )
  p2 <- VlnPlot(pat.object,
                features = i,
                pt.size = 0,
                group.by = "RNA_snn_res.0.8",
                log = F,
                cols = myColors2,
                assay = "RNA"
                ) + NoLegend() + geom_boxplot()
  vln <- p1+p2
  print(vln)
}
```

# Figure 5 {.tabset}
## Panel A
```{r,fig.height=10,fig.width=10}
# Assigning celltypes of independent objects to the combined one
for (i in 1:length(rownames(ETV6_2020@meta.data))){
    if (ETV6_2020@meta.data$ETV6status[i] %in% "Controls"){
        ETV6_2020@meta.data$barcode[i] <- paste("ctrl",rownames(ETV6_2020@meta.data)[i],sep = "_")
    }
    if (ETV6_2020@meta.data$ETV6status[i] %in% "Patients"){
        ETV6_2020@meta.data$barcode[i] <- paste("pat",rownames(ETV6_2020@meta.data)[i],sep = "_")
    }
}

tmp <- merge(x = ctrl.object,
            y = pat.object, 
            add.cell.ids = c("ctrl","pat")
            )

tmp_meta_data <- tmp@meta.data
tmp_meta_data$barcode <- rownames(tmp_meta_data)
tmp_meta_data <- tmp_meta_data[,-c(1:13,15:48,50:57)]

ETV6_tmp <- ETV6_2020@meta.data
ETV6_celltypes <- left_join(ETV6_tmp, tmp_meta_data)

ETV6_2020@meta.data$celltypes <- ETV6_celltypes$celltypes

# Plotting
DimPlot(object = ETV6_2020,
        pt.size = 0.7,
        reduction = "umap",
        group.by = "celltypes",
        order = T,
        split.by = "ETV6status"
        )

# removing tmp files 
rm(ETV6_tmp) 
rm(ETV6_celltypes)
rm(tmp)
```

## Panel C
```{r,fig.height=10,fig.width=10}

```


# Figure 6 {.tabset}
```{r, include=FALSE}
ETV6_2020@meta.data$celltypes_ETV6status <- paste(ETV6_2020@meta.data$ETV6status,
                                                  ETV6_2020@meta.data$celltypes,
                                                  sep = "_"
                                                  )
Idents(ETV6_2020) <- "celltypes_ETV6status"

all.genes <- rownames(ETV6_2020)
list_tmp <- c(unique(ETV6_2020@meta.data$celltypes))

for (i in list_tmp[1:length(list_tmp)]){
  if(i != "Plt"){
    if(file.exists(paste(OUTPUT_PATH,paste("celltype", i,"markers_ETV6_2020_full.csv", sep = "_"),sep = ""))){
       assign(paste("celltype", i,".markers_volcano", sep = ""),read.csv(paste(OUTPUT_PATH,paste("celltype", i,"markers_ETV6_2020_full.csv", sep = "_"),sep = "")))}
    else{
      assign(paste("celltype", i,".markers_volcano", sep = ""), FindMarkers(ETV6_2020,features = all.genes, ident.1 = paste("Patients", i, sep = "_"), ident.2 = paste("Controls", i, sep = "_"), only.pos = F, test.use = "bimod", logfc.threshold = 0))
      print(paste("celltype", i,".markers_volcano", sep = ""))
      print(head(get(paste("celltype", i,".markers_volcano", sep = "")),n=50))
      write.table(get(paste("celltype", i,".markers_volcano", sep = "")),
                  paste(OUTPUT_PATH, "celltype_", i,"_markers_ETV6_2020_full.csv", sep = ""), sep = ",", quote = F)}
  }
}
```

## Panel A
* HSPC
```{r}
# HSPCs
celltypeHSPC.markers_volcano$Significant <- ifelse(celltypeHSPC.markers_volcano$p_val_adj < 0.05&celltypeHSPC.markers_volcano$avg_log2FC > 0.37 | celltypeHSPC.markers_volcano$p_val_adj < 0.05 & celltypeHSPC.markers_volcano$avg_log2FC < -0.37,
                                                   ifelse(celltypeHSPC.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeHSPC.markers_volcano$Significant2 <- ifelse(celltypeHSPC.markers_volcano$p_val_adj < 0.05&celltypeHSPC.markers_volcano$avg_log2FC > 1 | celltypeHSPC.markers_volcano$p_val_adj < 0.05 & celltypeHSPC.markers_volcano$avg_log2FC < -1,
                                                   ifelse(celltypeHSPC.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeHSPC.markers_volcano$genename <- rownames(celltypeHSPC.markers_volcano)

# number of genes upregulated (> 1.3 FC)
length(rownames(celltypeHSPC.markers_volcano[celltypeHSPC.markers_volcano$Significant == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -1.3 FC)
length(rownames(celltypeHSPC.markers_volcano[celltypeHSPC.markers_volcano$Significant == "Downregulated bimod < 0.05",]))
# number of genes upregulated (> 2 FC)
length(rownames(celltypeHSPC.markers_volcano[celltypeHSPC.markers_volcano$Significant2 == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -2 FC)
length(rownames(celltypeHSPC.markers_volcano[celltypeHSPC.markers_volcano$Significant2 == "Downregulated bimod < 0.05",]))


ggplot(celltypeHSPC.markers_volcano, aes(x = avg_log2FC, y = -log10(p_val_adj))) +
  geom_point(aes(color = Significant))+
  scale_color_manual(values = c("blue", "lightgrey","red")) +
  theme_bw(base_size = 12) + theme(legend.position = "bottom") +
  scale_x_continuous( limits=c(-2.5, 2.5)) +
  # scale_y_continuous( limits=c(-1, 35)) +
  geom_vline(xintercept = c(-0.37, 0.37),10) +
  # geom_vline(xintercept = c(-1, 1),10) +
  geom_hline(yintercept = 1.3) +
  ggtitle(label = ".°.") +
  geom_text_repel(
    data = subset(celltypeHSPC.markers_volcano, avg_log2FC > 0.37 & p_val_adj < 0.05 | p_val_adj < 0.05 & avg_log2FC < -0.37),
    aes(label = genename),
    size = 3.4,
    box.padding = unit(0.25, "lines"),
    point.padding = unit(0.25, "lines"))
```

## Panel B
* CMP
```{r}
# CMPs
celltypeCMP.markers_volcano$Significant <- ifelse(celltypeCMP.markers_volcano$p_val_adj < 0.05&celltypeCMP.markers_volcano$avg_log2FC > 0.37 | celltypeCMP.markers_volcano$p_val_adj < 0.05 & celltypeCMP.markers_volcano$avg_log2FC < -0.37,
                                                   ifelse(celltypeCMP.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeCMP.markers_volcano$Significant2 <- ifelse(celltypeCMP.markers_volcano$p_val_adj < 0.05&celltypeCMP.markers_volcano$avg_log2FC > 1 | celltypeCMP.markers_volcano$p_val_adj < 0.05 & celltypeCMP.markers_volcano$avg_log2FC < -1,
                                                   ifelse(celltypeCMP.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeCMP.markers_volcano$genename <- rownames(celltypeCMP.markers_volcano)

# number of genes upregulated (> 1.3 FC)
length(rownames(celltypeCMP.markers_volcano[celltypeCMP.markers_volcano$Significant == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -1.3 FC)
length(rownames(celltypeCMP.markers_volcano[celltypeCMP.markers_volcano$Significant == "Downregulated bimod < 0.05",]))
# number of genes upregulated (> 2 FC)
length(rownames(celltypeCMP.markers_volcano[celltypeCMP.markers_volcano$Significant2 == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -2 FC)
length(rownames(celltypeCMP.markers_volcano[celltypeCMP.markers_volcano$Significant2 == "Downregulated bimod < 0.05",]))

ggplot(celltypeCMP.markers_volcano, aes(x = avg_log2FC, y = -log10(p_val_adj))) +
  geom_point(aes(color = Significant))+
  scale_color_manual(values = c("blue", "lightgrey","red")) +
  theme_bw(base_size = 12) + theme(legend.position = "bottom") +
  scale_x_continuous( limits=c(-2.5, 2.5)) +
  # scale_y_continuous( limits=c(-1, 35)) +
  geom_vline(xintercept = c(-0.37, 0.37), "black", 10) +
  geom_hline(yintercept = 1.3) +
  ggtitle(label = ".°.") +
  geom_text_repel(
    data = subset(celltypeCMP.markers_volcano, avg_log2FC > 0.37 & p_val_adj < 0.05 | p_val_adj < 0.05 & avg_log2FC < -0.37),
    aes(label = genename),
    size = 3.4,
    box.padding = unit(0.25, "lines"),
    point.padding = unit(0.25, "lines"))
```

## Panel C
* CMP_Primed
```{r}
# CMP_Primed
celltypeCMP_Primed.markers_volcano$Significant <- ifelse(celltypeCMP_Primed.markers_volcano$p_val_adj < 0.05&celltypeCMP_Primed.markers_volcano$avg_log2FC > 0.37 | celltypeCMP_Primed.markers_volcano$p_val_adj < 0.05 & celltypeCMP_Primed.markers_volcano$avg_log2FC < -0.37,
                                                   ifelse(celltypeCMP_Primed.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeCMP_Primed.markers_volcano$Significant2 <- ifelse(celltypeCMP_Primed.markers_volcano$p_val_adj < 0.05&celltypeCMP_Primed.markers_volcano$avg_log2FC > 1 | celltypeCMP_Primed.markers_volcano$p_val_adj < 0.05 & celltypeCMP_Primed.markers_volcano$avg_log2FC < -1,
                                                   ifelse(celltypeCMP_Primed.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeCMP_Primed.markers_volcano$genename <- rownames(celltypeCMP_Primed.markers_volcano)

# number of genes upregulated (> 1.3 FC)
length(rownames(celltypeCMP_Primed.markers_volcano[celltypeCMP_Primed.markers_volcano$Significant == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -1.3 FC)
length(rownames(celltypeCMP_Primed.markers_volcano[celltypeCMP_Primed.markers_volcano$Significant == "Downregulated bimod < 0.05",]))
# number of genes upregulated (> 2 FC)
length(rownames(celltypeCMP_Primed.markers_volcano[celltypeCMP_Primed.markers_volcano$Significant2 == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -2 FC)
length(rownames(celltypeCMP_Primed.markers_volcano[celltypeCMP_Primed.markers_volcano$Significant2 == "Downregulated bimod < 0.05",]))

ggplot(celltypeCMP_Primed.markers_volcano, aes(x = avg_log2FC, y = -log10(p_val_adj))) +
  geom_point(aes(color = Significant))+
  scale_color_manual(values = c("blue", "lightgrey","red")) +
  theme_bw(base_size = 12) + theme(legend.position = "bottom") +
  scale_x_continuous( limits=c(-2.5, 2.5)) +
  # scale_y_continuous( limits=c(-1, 35)) +
  geom_vline(xintercept = c(-0.37, 0.37), "black", 10) +
  geom_hline(yintercept = 1.3) +
  ggtitle(label = ".°.") +
  geom_text_repel(
    data = subset(celltypeCMP_Primed.markers_volcano, avg_log2FC > 0.37 & p_val_adj < 0.05 | p_val_adj < 0.05 & avg_log2FC < -0.37),
    aes(label = genename),
    size = 3.4,
    box.padding = unit(0.25, "lines"),
    point.padding = unit(0.25, "lines"))
```

## Panel D
* GMP
```{r}
# GMPs
celltypeGMP.markers_volcano$Significant <- ifelse(celltypeGMP.markers_volcano$p_val_adj < 0.05&celltypeGMP.markers_volcano$avg_log2FC > 0.37 | celltypeGMP.markers_volcano$p_val_adj < 0.05 & celltypeGMP.markers_volcano$avg_log2FC < -0.37,
                                                   ifelse(celltypeGMP.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeGMP.markers_volcano$Significant2 <- ifelse(celltypeGMP.markers_volcano$p_val_adj < 0.05&celltypeGMP.markers_volcano$avg_log2FC > 1 | celltypeGMP.markers_volcano$p_val_adj < 0.05 & celltypeGMP.markers_volcano$avg_log2FC < -1,
                                                   ifelse(celltypeGMP.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeGMP.markers_volcano$genename <- rownames(celltypeGMP.markers_volcano)

# number of genes upregulated (> 1.3 FC)
length(rownames(celltypeGMP.markers_volcano[celltypeGMP.markers_volcano$Significant == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -1.3 FC)
length(rownames(celltypeGMP.markers_volcano[celltypeGMP.markers_volcano$Significant == "Downregulated bimod < 0.05",]))
# number of genes upregulated (> 2 FC)
length(rownames(celltypeGMP.markers_volcano[celltypeGMP.markers_volcano$Significant2 == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -2 FC)
length(rownames(celltypeGMP.markers_volcano[celltypeGMP.markers_volcano$Significant2 == "Downregulated bimod < 0.05",]))

ggplot(celltypeGMP.markers_volcano, aes(x = avg_log2FC, y = -log10(p_val_adj))) +
  geom_point(aes(color = Significant))+
  scale_color_manual(values = c("blue", "lightgrey","red")) +
  theme_bw(base_size = 12) + theme(legend.position = "bottom") +
  scale_x_continuous( limits=c(-3, 3)) +
  # scale_y_continuous( limits=c(-1, 35)) +
  geom_vline(xintercept = c(-0.37, 0.37), "black", 10) +
  geom_vline(xintercept = c(-1, 1), "black", 10) +
  geom_hline(yintercept = 1.3) +
  ggtitle(label = ".°.") +
  geom_text_repel(
    data = subset(celltypeGMP.markers_volcano, avg_log2FC > 0.37 & p_val_adj < 0.05 | p_val_adj < 0.05 & avg_log2FC < -0.37),
    aes(label = genename),
    size = 3.4,
    box.padding = unit(0.25, "lines"),
    point.padding = unit(0.25, "lines"))
```

## Panel E
* MEP
```{r}
# MEPs
celltypeMEP.markers_volcano$Significant <- ifelse(celltypeMEP.markers_volcano$p_val_adj < 0.05&celltypeMEP.markers_volcano$avg_log2FC > 0.37 | celltypeMEP.markers_volcano$p_val_adj < 0.05 & celltypeMEP.markers_volcano$avg_log2FC < -0.37,
                                                   ifelse(celltypeMEP.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeMEP.markers_volcano$Significant2 <- ifelse(celltypeMEP.markers_volcano$p_val_adj < 0.05&celltypeMEP.markers_volcano$avg_log2FC > 1 | celltypeMEP.markers_volcano$p_val_adj < 0.05 & celltypeMEP.markers_volcano$avg_log2FC < -1,
                                                   ifelse(celltypeMEP.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeMEP.markers_volcano$genename <- rownames(celltypeMEP.markers_volcano)

# number of genes upregulated (> 1.3 FC)
length(rownames(celltypeMEP.markers_volcano[celltypeMEP.markers_volcano$Significant == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -1.3 FC)
length(rownames(celltypeMEP.markers_volcano[celltypeMEP.markers_volcano$Significant == "Downregulated bimod < 0.05",]))
# number of genes upregulated (> 2 FC)
length(rownames(celltypeMEP.markers_volcano[celltypeMEP.markers_volcano$Significant2 == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -2 FC)
length(rownames(celltypeMEP.markers_volcano[celltypeMEP.markers_volcano$Significant2 == "Downregulated bimod < 0.05",]))

ggplot(celltypeMEP.markers_volcano, aes(x = avg_log2FC, y = -log10(p_val_adj))) +
  geom_point(aes(color = Significant))+
  scale_color_manual(values = c("blue", "lightgrey","red")) +
  theme_bw(base_size = 12) + theme(legend.position = "bottom") +
  #scale_x_continuous( limits=c(-2.5, 2.5)) +
  # scale_y_continuous( limits=c(-1, 35)) +
  geom_vline(xintercept = c(-0.37, 0.37), "black", 10) +
  geom_hline(yintercept = 1.3) +
  ggtitle(label = "") +
  geom_text_repel(
    data = subset(celltypeMEP.markers_volcano, avg_log2FC > 0.75 | -log10(p_val_adj) > 230 | avg_log2FC < -0.75),
    aes(label = genename),
    size = 3.4,
    box.padding = unit(0.25, "lines"),
    point.padding = unit(0.25, "lines"))
```

## Panel F
* MkP Mk
```{r}
# MkP_Mks
celltypeMkP_Mk.markers_volcano$Significant <- ifelse(celltypeMkP_Mk.markers_volcano$p_val_adj < 0.05&celltypeMkP_Mk.markers_volcano$avg_log2FC > 0.37 | celltypeMkP_Mk.markers_volcano$p_val_adj < 0.05 & celltypeMkP_Mk.markers_volcano$avg_log2FC < -0.37,
                                                   ifelse(celltypeMkP_Mk.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeMkP_Mk.markers_volcano$Significant2 <- ifelse(celltypeMkP_Mk.markers_volcano$p_val_adj < 0.05&celltypeMkP_Mk.markers_volcano$avg_log2FC > 1 | celltypeMkP_Mk.markers_volcano$p_val_adj < 0.05 & celltypeMkP_Mk.markers_volcano$avg_log2FC < -1,
                                                   ifelse(celltypeMkP_Mk.markers_volcano$avg_log2FC > 0,
                                                          "Upregulated bimod < 0.05",
                                                          "Downregulated bimod < 0.05"),
                                                   "Not Significative"
                                                   )

celltypeMkP_Mk.markers_volcano$genename <- rownames(celltypeMkP_Mk.markers_volcano)

# number of genes upregulated (> 1.3 FC)
length(rownames(celltypeMkP_Mk.markers_volcano[celltypeMkP_Mk.markers_volcano$Significant == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -1.3 FC)
length(rownames(celltypeMkP_Mk.markers_volcano[celltypeMkP_Mk.markers_volcano$Significant == "Downregulated bimod < 0.05",]))
# number of genes upregulated (> 2 FC)
length(rownames(celltypeMkP_Mk.markers_volcano[celltypeMkP_Mk.markers_volcano$Significant2 == "Upregulated bimod < 0.05",]))
# number of genes downregulated (< -2 FC)
length(rownames(celltypeMkP_Mk.markers_volcano[celltypeMkP_Mk.markers_volcano$Significant2 == "Downregulated bimod < 0.05",]))

ggplot(celltypeMkP_Mk.markers_volcano, aes(x = avg_log2FC, y = -log10(p_val_adj))) +
  geom_point(aes(color = Significant))+
  scale_color_manual(values = c("blue", "lightgrey","red")) +
  theme_bw(base_size = 12) + theme(legend.position = "bottom") +
  #scale_x_continuous( limits=c(-2.5, 2.5)) +
  # scale_y_continuous( limits=c(-1, 35)) +
  geom_vline(xintercept = c(-0.37, 0.37), "black", 10) +
  geom_hline(yintercept = 1.3) +
  ggtitle(label = "") +
  geom_text_repel(
    data = subset(celltypeMkP_Mk.markers_volcano, avg_log2FC > 1.3 | -log10(p_val_adj) > 275 | avg_log2FC < -1.3),
    aes(label = genename),
    size = 3.4,
    box.padding = unit(0.25, "lines"),
    point.padding = unit(0.25, "lines"))
```

```{r}
# extract both lists (Up/Down) for each celltype comparison
# for (i in list_tmp[1:length(list_tmp)]){
#   if(i != "Plt"){
#     assign(paste("celltype", i,".markers_volcano_1_3", sep = ""),rownames(get(paste("celltype", i,"markers_volcano")$Significant)))
#       print(paste("celltype", i,".markers_volcano_1_3", sep = ""))
#       print(head(get(paste("celltype", i,".markers_volcano_1_3", sep = "")),n=50))
#       write.table(get(paste("celltype", i,".markers_volcano_1_3", sep = "")),
#                   paste(OUTPUT_PATH,"celltype", i,".markers_volcano_1_3.txt", sep = "_"),
#                   quote=FALSE,row.names = TRUE, sep = "/n")
#       }
# }
```


# Figure 6 bis {.tabset}

* Some of following plots are scripted here but plotted in "supplemental_figures.Rmd"

## Down {.tabset}
### Barplots {.tabset}
#### GO
![Down_Barplot_GO](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_barplot_GO_Biological_Process_2018.png)

#### KEGG
![Down_Barplot_KEGG](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_barplot_KEGG_2019_Human.png)

#### REACTOME
![Down_Barplot_REACT](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_barplot_Reactome_2016.png)

#### TRANSCRIPTION_FACTOR
![Down_Barplot_TF](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_barplot_Transcription_Factor_PPIs.png)

#### TRANSFAC_JASPAR
![Down_Barplot_JASP](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_barplot_TRANSFAC_and_JASPAR_PWMs.png)



### Bubbleplots {.tabset}
#### GO
![Down_Bubbleplot_GO](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_bubbleplot_GO_Biological_Process_2018.png)

#### KEGG
![Down_Bubbleplot_KEGG](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_bubbleplot_KEGG_2019_Human.png)

#### REACTOME
![Down_Bubbleplot_REACT](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_bubbleplot_Reactome_2016.png)

#### TRANSCRIPTION_FACTOR
![Down_Bubbleplot_TF](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_bubbleplot_Transcription_Factor_PPIs.png)

#### TRANSFAC_JASPAR
![Down_Bubbleplot_JASP](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/DOWN_bubbleplot_TRANSFAC_and_JASPAR_PWMs.png)




## Up {.tabset}
### Barplots {.tabset}
#### GO
![Up_Barplot_GO](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_barplot_GO_Biological_Process_2018.png)

#### KEGG
![Up_Barplot_KEGG](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_barplot_KEGG_2019_Human.png)

#### REACTOME
![Up_Barplot_REACT](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_barplot_Reactome_2016.png)

#### TRANSCRIPTION_FACTOR
![Up_Barplot_TF](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_barplot_Transcription_Factor_PPIs.png)

#### TRANSFAC_JASPAR
![Up_Barplot_JASP](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_barplot_TRANSFAC_and_JASPAR_PWMs.png)


### Bubbleplots {.tabset}
#### GO
![Up_Bubbleplot_GO](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_bubbleplot_GO_Biological_Process_2018.png)

#### KEGG
![Up_Bubbleplot_KEGG](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_bubbleplot_KEGG_2019_Human.png)

#### REACTOME
![Up_Bubbleplot_REACT](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_bubbleplot_Reactome_2016.png)

#### TRANSCRIPTION_FACTOR
![Up_Bubbleplot_TF](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_bubbleplot_Transcription_Factor_PPIs.png)

#### TRANSFAC_JASPAR
![Up_Bubbleplot_JASP](/home/bigott/workspace/Papers/ETV6/99_figures_papier/01_figure_1/enrichR/INPUT_DEGs/enrichR/plots/UP_bubbleplot_TRANSFAC_and_JASPAR_PWMs.png)

# Figure 6 ter {.tabset}

* Colored by celltypes

* Some of following plots are scripted here but plotted in "supplemental_figures.Rmd"

## Controls {.tabset}
### nCounts
```{r}
myColors <- c("#7CAE00","#04BF68","#F26D6D","#CD9600","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#CC88FF","#CC88FF","#CC88FF","#CC88FF","#CC88FF","#F25ECB")
Idents(ctrl.object) <- "RNA_snn_res.1.2"
ctrl.object@meta.data$RNA_snn_res.1.2 <- factor(ctrl.object@meta.data$RNA_snn_res.1.2,
                                   levels = c("13","10","7","11","9","5","4","0","2","1","3","6","8","12","14")
                                   )
# nFeature_RNA
# nCount_RNA

VlnPlot(ctrl.object, features = "nCount_RNA", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

### nFeatures
```{r}
myColors <- c("#7CAE00","#04BF68","#F26D6D","#CD9600","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#CC88FF","#CC88FF","#CC88FF","#CC88FF","#CC88FF","#F25ECB")
Idents(ctrl.object) <- "RNA_snn_res.1.2"
ctrl.object@meta.data$RNA_snn_res.1.2 <- factor(ctrl.object@meta.data$RNA_snn_res.1.2,
                                   levels = c("13","10","7","11","9","5","4","0","2","1","3","6","8","12","14")
                                   )
# nFeature_RNA
# nCount_RNA

VlnPlot(ctrl.object, features = "nFeature_RNA", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

### Genes {.tabset}
#### ITGA2B
```{r}
VlnPlot(ctrl.object, features = "ITGA2B", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### ITGB3
```{r}
VlnPlot(ctrl.object, features = "ITGB3", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### PF4
```{r}
VlnPlot(ctrl.object, features = "PF4", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### GP9
```{r}
VlnPlot(ctrl.object, features = "GP9", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### GP6
```{r}
VlnPlot(ctrl.object, features = "GP6", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### P2RY1
```{r}
VlnPlot(ctrl.object, features = "P2RY1", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### MYH9
```{r}
VlnPlot(ctrl.object, features = "MYH9", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### GATA1
```{r}
VlnPlot(ctrl.object, features = "GATA1", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### GATA2
```{r}
VlnPlot(ctrl.object, features = "GATA2", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### FLI1
```{r}
VlnPlot(ctrl.object, features = "FLI1", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### TAL1
```{r}
VlnPlot(ctrl.object, features = "TAL1", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### ETV6   
```{r}
VlnPlot(ctrl.object, features = "ETV6", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### RUNX1   
```{r}
VlnPlot(ctrl.object, features = "RUNX1", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### CD34   
```{r}
VlnPlot(ctrl.object, features = "CD34", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### HLA-DRA   
```{r}
VlnPlot(ctrl.object, features = "HLA-DRA", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### DNM1L   
```{r}
VlnPlot(ctrl.object, features = "DNM1L", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### CD38   
```{r}
VlnPlot(ctrl.object, features = "CD38", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### DNM1L   
```{r}
VlnPlot(ctrl.object, features = "DNM1L", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### CYCS   
```{r}
VlnPlot(ctrl.object, features = "CYCS", pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### PTPRCetc   
```{r}
VlnPlot(ctrl.object, features = c("PTPRC","ITGB2","IL18","PIM1","MYCT1","MYCBP2"), pt.size = 0.05, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

#### RPS   
```{r}
VlnPlot(ctrl.object, features = c("RPS26","RPS27","RPS27L","RPL3","RPSA","RPL4","RPL6","RPS3","RPS6"), pt.size = 0, group.by = "RNA_snn_res.1.2", log = F,cols = myColors)
```

## Patients {.tabset}
### nCounts
```{r}
myColors <- c("#7CAE00","#04BF68","#04BF68","#CD9600","#F26D6D","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#CC88FF")
Idents(pat.object) <- "RNA_snn_res.0.8"
pat.object@meta.data$RNA_snn_res.0.8 <- factor(pat.object@meta.data$RNA_snn_res.0.8,
                                  levels = c("9","3","7","10","4","5","2","6","8","0","1")
                                  )
# nFeature_RNA
# nCount_RNA

VlnPlot(pat.object, features = "nCount_RNA", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

### nFeatures
```{r}
myColors <- c("#7CAE00","#04BF68","#04BF68","#CD9600","#F26D6D","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#05AFF2","#CC88FF")
Idents(pat.object) <- "RNA_snn_res.0.8"
pat.object@meta.data$RNA_snn_res.0.8 <- factor(pat.object@meta.data$RNA_snn_res.0.8,
                                  levels = c("9","3","7","10","4","5","2","6","8","0","1")
                                  )

VlnPlot(pat.object, features = "nFeature_RNA", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

### Genes {.tabset}
#### ITGA2B
```{r}
VlnPlot(pat.object, features = "ITGA2B", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### ITGB3
```{r}
VlnPlot(pat.object, features = "ITGB3", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### PF4
```{r}
VlnPlot(pat.object, features = "PF4", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### GP9
```{r}
VlnPlot(pat.object, features = "GP9", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### GP6
```{r}
VlnPlot(pat.object, features = "GP6", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### P2RY1
```{r}
VlnPlot(pat.object, features = "P2RY1", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### MYH9
```{r}
VlnPlot(pat.object, features = "MYH9", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### MYH9
```{r}
VlnPlot(pat.object, features = "GATA1", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### GATA1
```{r}
VlnPlot(pat.object, features = "GATA1", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### GATA2
```{r}
VlnPlot(pat.object, features = "GATA2", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### FLI1
```{r}
VlnPlot(pat.object, features = "FLI1", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### TAL1
```{r}
VlnPlot(pat.object, features = "TAL1", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### ETV6
```{r}
VlnPlot(pat.object, features = "ETV6", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### RUNX1
```{r}
VlnPlot(pat.object, features = "RUNX1", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### CD34
```{r}
VlnPlot(pat.object, features = "CD34", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### HLA-DRA
```{r}
VlnPlot(pat.object, features = "HLA-DRA", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### HLA-DRA
```{r}
VlnPlot(pat.object, features = "HLA-DRA", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### DNM1L
```{r}
VlnPlot(pat.object, features = "DNM1L", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### CD38
```{r}
VlnPlot(pat.object, features = "CD38", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### DNM1L
```{r}
VlnPlot(pat.object, features = "DNM1L", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### CYCS   
```{r}
VlnPlot(pat.object, features = "CYCS", pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### PTPRCetc   
```{r}
VlnPlot(pat.object, features = c("PTPRC","ITGB2","IL18","PIM1","MYCT1","MYCBP2"), pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

#### RP   
```{r}
VlnPlot(pat.object, features = c("RPS26","RPS27","RPS27L","RPL3","RPSA","RPL4","RPL6","RPS3","RPS6"), pt.size = 0.05, group.by = "RNA_snn_res.0.8", log = F,cols = myColors)
```

# Figure 8
## Dotplot genes p53 related
```{r,fig.width=16,fig.height=8}
# DotPlot of supervised signatures for clusters identification
Idents(ETV6_2020) <- "celltypes_ETV6status"

ETV6_2020@meta.data$celltypes_ETV6status <- factor(ETV6_2020@meta.data$celltypes_ETV6status,
                                           levels = c("Controls_HSPC", "Patients_HSPC","Controls_CMP", "Patients_CMP","Controls_CMP_Primed", "Patients_CMP_Primed","Controls_GMP", "Patients_GMP","Controls_MEP", "Patients_MEP","Controls_MkP_Mk", "Patients_MkP_Mk","Controls_Plt")
                                           )

dp <- DotPlot(ETV6_2020,
              # idents = c("Controls_MEP", "Patients_MEP","Controls_MkP_Mk", "Patients_MkP_Mk"),
              features = c("TTK","NUDT1","DUT","UBE2V2","UBE2T","RBX1","USP1","UCHL5","MGMT","FEN1","RAD23A","RAD23B","XRCC6","PRKDC","SFPQ","SF3B5","PTTG1","RPA3","SWI5","SMARCB1","SMC1A","RNASEH2C","RNASEH2B","SEM1","TAF9","PARP1","POLD2","POLR2I","RUVBL2","RUVBL1","HMGN1","HMGB1","MORF4L2","CENPX","SSRP1","PARK7","NUCKS1","ACTL6A","ACTB")
              ) + 
  geom_point(aes(size=pct.exp),
             shape = 21,
             colour="black",
             stroke=0.5
             ) + 
  scale_colour_gradient2(low = "steelblue",
                         mid = "ivory1",
                         high = "red"
                         ) + 
  guides(size=guide_legend(override.aes=list(shape=21, colour="black", fill="white"))
         ) + 
  RotatedAxis()
dp
```
